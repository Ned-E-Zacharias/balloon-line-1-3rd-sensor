#AUTO
    IA192,168,1,21
NO-BALLOON-LINE-1-STEP-AND-REPEAT
NO-CENTER-SENSOR-IS-IN[1]
NO-TOP-TB-SENSOR-IS-IN[6]
    CIRCUM=3.5*3.14159265
    CONST1=5
    CONST2=16200
    CORRFACT=8.
    INCH=((CONST2*CONST1)/CIRCUM)*CORRFACT
    ACCEL=170
    DECEL=170
    JOGSP=700
    REPEAT=19
    PASTEYE=3
    SPEED=1500
    DSPSENS=51
    GAIN=5
    SHX
    XQ#MOTION,1
#COMU
    CB3
    IN,SPEED
    SB3
    IN,REPEAT
    JP#NOSYNC,REPEAT>90
JP#SYNC

#NOSYNC
    REPEAT=90
#SYNC
    IN,PASTEYE
    JP#COMU
EN

EN

#MOTION
    CN-1,-1,-1
#MAIN
    CB4
    JS#JOG,(@IN[3]=0)
    JS#DMOVE,(@IN[4]=0)
    JS#REGMOVE,(@IN[5]=0)
    ST
NO-A-REPEATS-BETWEEN-SENSOR-STATIONS
    AAAA=DSPSENS/REPEAT
NO-AB-FRACTIONAL-REPEAT-BETWEEN-SENSOR-STATIONS
    AAAB=(@FRAC[AAAA])
NO-AC-FRACTIONAL-REPEATS-IN INCHES
    AAAC=AAAB(REPEAT)
NO-AD-DISTANCE-TO-NEXT-EYESPOT
    AAAD=AAAC-PASTEYE 
NO-TBLOOK-SET-WINDOW-CONVERT-TO-PULSES
    TBLOOK = AAAD-1 * INCH
    JP#MAIN
EN

#JOG
    SB4
    ACX=ACCEL*INCH
    DCX=DECEL*INCH
    JG((JOGSP*INCH)/60)
    BGX
    AI+3
EN

#DMOVE
    SB4
    SHX
    SB3
    PRX=REPEAT*INCH
    ACX=ACCEL*INCH
    DCX=DECEL*INCH
    SPX=(SPEED*INCH)/60
    BGX
    AM
EN

#REGMOVE
    SB4
    DP0
    SHX
    EREPEAT=(REPEAT*INCH)
    DPI=(PASTEYE*INCH)
    LOOKP=(EREPEAT-DPI-(2*INCH))
    ACX=ACCEL*INCH
    DCX=DECEL*INCH
    SPX=(SPEED*INCH)/60
    PRX=(REPEAT-0.5)*INCH
    TOOFAR=_PRX-INCH
    BGX

    LTX=DPI

    SEENBOT=0
    SEENTOP=0
    SEENBOTH=0
    #WAIT
        JP#LOOKP,_TPX>LOOKP 
        JP#MISSED,_TPX>TOOFAR
        JS#TBLOOK,_TPX>TBLOOK
        JS#ANALOG,SEENBOTH=2
        
    JP#WAIT


    JP#OUT2,SEENBOT=1
JP#OUT1

#SEEBOT
    BOTTOM=_TPX
    SEENBOT=1
JP#WAIT

#SEETOP
    TOP=_TPX
    SEENTOP=1
JP#WAIT




#ANALOG
    AM
    DIF=(TOP-BOTTOM)*GAIN
    DIFF=(DIF/INCH)
    DIFFOUT=DIFF+5
    AODIFFOUT
    AM
JP#WAIT
EN

JP#MOTION

EN

#LOOKP
    JP#WAIT,_ALX=1
    ALX
JP#LOOKP

#TBLOOK
    JP#SEENBOT,SEENBOT=1
    JP#SEEBOT,(@IN[2]=0)
    #SEENBOT
    JP#SEENTOP,SEENTOP=1
    JP#SEETOP,(@IN[6]=0)
    #SEENTOP
    SEENBOTH=SEENBOT+SEENTOP
    JP#ANALOG,SEENBOTH>1
    JP#WAIT
EN
JP#TBLOOK

